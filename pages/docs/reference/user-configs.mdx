# User configs

## About

This article will list practical examples of user-configs. It is assumed you already understand the meaning and creation of user configs. See the [customize-app-config](/docs/getting-started/customize-app-config) section for more information.

## runtipi

### traefik

#### customized-traefik-config

- make default traefik config writeable
- make your own traefik config

##### make traefik config writeable

##### make you own traefik config

```
cd ~/runtipi
sudo ./runtipi-cli stop
# stop all containers (optional)
docker stop $(docker ps -a -q)
mkdir -p app-data/traefik/etc
mkdir -p app-data/traefik/shared
sudo cp -R traefik/dynamic traefik/tls traefik/traefik.yml app-data/traefik/etc
sudo cp -R traefik/shared app-data/traefik
sudo chown -R user:user traefik/
touch user-config/tipi-compose.yml
```

user-config/tipi-compose.yml:

```yml
version: '3.9'
services:
  runtipi-reverse-proxy:
    volumes:
      - ./app-data/traefik/etc:/etc/traefik
      - ./app-data/traefik/shared:/shared
```

```bash
~/runtipi/app-data/traefik$ tree
.
├── etc
│   ├── dynamic
│   │   └── dynamic.yml
│   ├── tls
│   │   ├── cert.pem
│   │   ├── key.pem
│   └── traefik.yml
└── shared
    └── acme.json
```

```
sudo ./runtipi-cli start
```
#### expose traefik dashboard

- tested with runtipi v3.1.3

http://`${INTERNAL_IP}`:8080

runtipi/user-config/tipi-compose.yml:

```yml
version: '3.9'
services:
  runtipi-reverse-proxy:
    ports:
      - 8080:8080
```
#### logrotate traefik logs

- required: [customized-traefik-config](#customized-traefik-config)
- traefik logs will not be available in apps like dozzle or portainer!

```bash
mkdir /var/log/traefik
sudo vim /etc/logrotate.d/traefik
```

/etc/logrotate.d/traefik:

```bash
/var/log/traefik/*.log {
        daily
        compress
        delaycompress
        logrotate 7
        postrotate
        docker kill --signal="USR1" runtipi-reverse-proxy
        endscript
}
```

runtipi/user-config/tipi-compose.yml:

```yml
version: '3.9'
services:
  runtipi-reverse-proxy:
    volumes:
      - /var/log/traefik/:/var/log/
```

runtipi/app-data/traefik/etc/traefik.yml:

```yml
log:
  filePath: "/var/log/traefik.log"
  level: ERROR

accessLog:
  filePath: "/var/log/access.log"
```

### runtipi

#### routers

- tested with runtipi v3.1.3
- stop exposing the tipi portal on any Url other than the configured one.
- only use the cert receiver on `DOMAIN` exposed routers
- applying middlewares (must be configured separate)

runtipi/user-config/tipi-compose.yml:

```yml
version: '3.9'
services:
  runtipi:
    labels:
      # ---- General ----- #

      # ---- Dashboard ----- #
      # Local ip
      traefik.http.routers.dashboard.rule: (Host(`${INTERNAL_IP}`) || Host(`tipi.${LOCAL_DOMAIN}`)) && PathPrefix(`/`)
      # Websecure
      traefik.http.routers.dashboard-secure.middlewares: authentik@file, geoblock@file

      # ---- Worker ----- #
      # Local ip
      traefik.http.routers.worker.rule: (Host(`${INTERNAL_IP}`) || Host(`tipi.${LOCAL_DOMAIN}`)) && PathPrefix(`/worker`)
      # Websecure
      traefik.http.routers.worker-insecure.rule: Host(`${DOMAIN}`) && PathPrefix(`/worker`)
      traefik.http.routers.worker-secure.rule: Host(`${DOMAIN}`) && PathPrefix(`/worker`)
      traefik.http.routers.worker-secure.middlewares: authentik@file, geoblock@file
      traefik.http.routers.worker-api-insecure.rule: Host(`${DOMAIN}`) && PathPrefix(`/worker-api`)
      traefik.http.routers.worker-api-secure.rule: Host(`${DOMAIN}`) && PathPrefix(`/worker-api`)
      traefik.http.routers.worker-api-secure.middlewares: authentik@file, geoblock@file
      # Local domain
      traefik.http.routers.worker-local-insecure.rule: (Host(`${INTERNAL_IP}`) || Host(`tipi.${LOCAL_DOMAIN}`)) && PathPrefix(`/worker`)
      traefik.http.routers.worker-api-local-insecure.rule: (Host(`${INTERNAL_IP}`) || Host(`tipi.${LOCAL_DOMAIN}`)) && PathPrefix(`/worker-api`)
      # Secure
      traefik.http.routers.worker-local.rule: (Host(`${INTERNAL_IP}`) || Host(`tipi.${LOCAL_DOMAIN}`)) && PathPrefix(`/worker`)
      traefik.http.routers.worker-api-local.rule: (Host(`${INTERNAL_IP}`) || Host(`tipi.${LOCAL_DOMAIN}`)) && PathPrefix(`/worker-api`)
```
## Apps

### general

#### config 1



### 2fauth

#### config 1

- changes the used URL to the `LOCAL_DOMAIN` (default `APP_DOMAIN`)

runtipi/user-config/2fauth/docker-compose.yml

```yml
version: "3.7"
services:
  2fauth:
    environment:
      - ASSET_URL=https://2fauth.${LOCAL_DOMAIN}
      - APP_URL=https://2fauth.${LOCAL_DOMAIN}

```

### authentik

#### config 1

- adds a geonlock middleware (must be configured separate)
- adds a backend network (only accesible inside the stack)
- adds a db-backup service

runtipi/user-config/authentik/docker-compose.yml

```yml
version: "3.7"

services:
  authentik:
    labels:
      # Websecure
      traefik.http.routers.authentik.middlewares: geoblock@file

  authentik-db:
    networks:
      - backend_network

  dbbackup:
    image: tiredofit/db-backup:4.0.34
    container_name: authentik-db-backup
    environment:
      - DEFAULT_COMPRESSION=GZ
      - DB01_TYPE=pgsql
      - DB01_HOST=authentik-db
      - DB01_NAME=authentik
      - DB01_USER=authentik
      - DB01_PASS=${AUTHENTIK_DB_PASSWORD}
      - CONTAINER_ENABLE_MONITORING=FALSE
      - DEFAULT_CLEANUP_TIME=1440
    restart: unless-stopped
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ${APP_DATA_DIR}/data/db-backup:/backup
    depends_on:
      - authentik-db
    networks:
      - backend_network

networks:
  backend_network:
```